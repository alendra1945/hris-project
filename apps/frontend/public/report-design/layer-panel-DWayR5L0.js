import{u as e,A as t,w as s,d as r,x as n,B as a,h as i,C as d,D as l,c as o,o as g,q as c,a as v,G as u,H as k,I as p,s as m,E as y,f,e as h,m as b,i as I,j as x,J as L,F as E,n as S,k as w,y as T,t as M,K as C,S as D,b as O}from"./reporting-template-design-web-C1jkFslm.js";import{c as A,d as j}from"./index-n8EjtbSE.js";import{D as P,i as R}from"./index-Dfg5pT9a.js";import{C as z,a as N,b as q,c as H}from"./context-menu-Bxr69ITp.js";import{P as B}from"./panel-resizer-CyRcXSc8.js";const F=d(),G=d=>{const[l]=e(),o=()=>l.documentState,[g,c]=t({initialIds:[],sortedIds:[],dataIdTree:{}}),v=e=>e>=0&&e<g.initialIds.length,u=(e,t=null,s=[])=>e.reduce(((e,{content:r,id:n})=>(c("dataIdTree",n,{id:n,parentId:t,parentIdPath:s,childrenIds:r.map((e=>e.id)),contentLength:r.length}),t&&c("dataIdTree",t,"contentLength",(e=>e+r.length)),[...e,n,...u(r,n,[...s,n])])),[]);s((()=>{r((()=>{const e=u([...d.ids]);c("initialIds",e),c("sortedIds",e)}))})),s((()=>{o().activeMovingLayer.draggableLayerId&&o().activeMovingLayer.droppableLayerId?n((()=>{const e=g.sortedIds.indexOf(o().activeMovingLayer.draggableLayerId),t=g.initialIds.indexOf(o().activeMovingLayer.droppableLayerId);if(v(e)&&v(t)){if(e!==t&&!g.dataIdTree[o().activeMovingLayer.droppableLayerId].parentIdPath.includes(o().activeMovingLayer.draggableLayerId)&&(g.dataIdTree[o().activeMovingLayer.draggableLayerId].parentId||!g.dataIdTree[o().activeMovingLayer.draggableLayerId].parentId&&!g.dataIdTree[o().activeMovingLayer.droppableLayerId].parentId)&&g.dataIdTree[o().activeMovingLayer.draggableLayerId].parentId!=o().activeMovingLayer.droppableLayerId){const s=a(g.sortedIds,e,t,g.dataIdTree[o().activeMovingLayer.draggableLayerId].contentLength);c("sortedIds",s)}}else c("sortedIds",u([...d.ids]))})):c("sortedIds",u([...d.ids]))}));const k=[g,{}];return i(F.Provider,{value:k,get children(){return d.children}})},J=(t,r)=>{const[n]=l(F)||null,[a,{addLayer:i,removeLayer:d,draggableActivators:m,addTransformer:y,removeTransformer:f}]=e(),[h,b]=o(null),I=()=>a.documentState,x=e=>a.documentState.layerElement[e]?.layout||null,L=()=>I().layerElement[I().activeMovingLayer.draggableLayerId||""],E=()=>{const e=p();if(!L())return e;if(L().id===t)return e;if(!L().data.parentId&&r.parentId)return e;if(L().data.parentId&&L().data.parentIds.includes(t))return e;if(L().data.parentId&&L().data.parentId!==r.parentId)return e;{const s=n.initialIds.indexOf(t);let r=n.sortedIds.indexOf(t);if(r!==s){const s=x(t),a=x(n.initialIds[r]);s&&a&&(e.x=a.x-s.x,e.y=a.y-s.y)}}return e},S={id:"treeLayerOffset",order:100,callback:e=>{const t=E();return{x:e.x,y:e.y+t.y}}},w=()=>a.documentState.layerElement[t]?.transform||p();g((()=>{const e=h();e&&(i({id:t,node:e,layout:c(e),data:r}),y("layer",t,S))})),v((()=>{f("layer",t,S.id),d(t)}));return Object.defineProperties(((e,r)=>{const n=r?r():{};s((()=>{const e=h(),s=m(t,"layer");if(e)for(const t in s)e.addEventListener(t,s[t]);v((()=>{if(e)for(const t in s)e.removeEventListener(t,s[t])}))})),b(e),n.skipTransform||s((()=>{const t=w();if(u(t,p()))e.style.removeProperty("transform");else{const t=k(w());e.style.setProperty("transform",t.transform??null)}}))}),{ref:{enumerable:!0,value:b},transform:{enumerable:!0,get:w},isActiveDraggable:{enumerable:!0,get:()=>a.documentState.activeMovingLayer.draggableLayerId===t},dragActivators:{enumerable:!0,get:()=>m(t,"layer",!0)},isActiveDroppable:{enumerable:!0,get:()=>a.documentState.activeMovingLayer.droppableLayerId===t}})};var K=M("<div>"),X=M('<div><span class="group gkvis-my-[4px] gkvis-flex gkvis-items-center gkvis-gap-1.5 gkvis-pr-[2px]"><span>');const Y=t=>{const[s,r]=m(t,["details","depth","parentId","parentIds","index"]),n=()=>s.parentId?[...s.parentIds,s.parentId]:s.parentIds,a=J(s.details.id,{depth:s.depth,index:s.index,type:s.details.type,parentId:s.parentId,parentIds:n(),childrenIds:s.details.content.map((e=>e.id))}),[d,l]=o(s.details.type!==y.TABLE&&!["table","thead","tbody","tr","th","td"].includes(s.details.originalElement||"")),[g,{deleteElement:c,duplicateElement:v}]=e(),u=()=>g.documentState.blockNodeElement[s.details.id],k=()=>{l((e=>!e))},p=[{label:"Duplicate",action:()=>{v(s.details.id)},condition:()=>!(t.details.type===y.SECTION||t.details.isRepeaterElement||["thead","tbody"].includes(t.details.originalElement||""))},{label:"Delete",action:()=>{c(s.details.id)},condition:()=>!(t.details.type===y.SECTION)}];return i(H,{get children(){return[i(z,{as:"div",get children(){var e=X(),t=e.firstChild,l=t.firstChild;return f(a,e,(()=>a)),h(e,b({get"data-block-layer-id"(){return s.details.id}},r,{get class(){return A(s.details.classes,"gkvis-relative gkvis-min-w-24 gkvis-px-1 gkvis-cursor-grab gkvis-rounded gkvis-border gkvis-border-transparent gkvis-bg-white gkvis-text-lg gkvis-text-gray-600",(a.isActiveDraggable||1===g.documentState.selectedElementIds.length&&g.documentState.selectedElementIds.includes(s.details.id))&&"gkvis-border-blue-300 gkvis-z-50",a.isActiveDroppable&&"gkvis-z-0")}}),!1,!0),I(t,i(x,{get when(){return(u()?.isContainer||u()?.isTable)&&s.details.content.length||u()?.isRoot},get children(){return i(j,{get class(){return A("gkvis-size-5 -gkvis-mt-1",!d()&&"-gkvis-rotate-90")},onClick:k})}}),l),I(t,i(P,{get as(){return u()?.getIcon()},class:"gkvis-size-4 gkvis-shrink-0"}),l),I(l,i(x,{get when(){return u()?.isText},get children(){return`${s.details.originalElement} | ${L(s.details?.innerHTML||"")}`}}),null),I(l,i(x,{get when(){return!u()?.isText},get children(){return s.details.name}}),null),I(e,i(x,{get when(){return s.details.content.length},get children(){var e=K();return I(e,i(E,{get each(){return s.details.content},children:(e,t)=>i(Y,{details:e,get index(){return t()},get parentId(){return s.details.id},get depth(){return s.depth+1},get parentIds(){return n()}})})),S((t=>{var r=A(!d()&&"gkvis-hidden"),n=w(s.depth+12);return r!==t.e&&T(e,t.e=r),n!==t.t&&(null!=(t.t=n)?e.style.setProperty("padding-left",n):e.style.removeProperty("padding-left")),t}),{e:void 0,t:void 0}),e}}),null),S((()=>T(l,A("gkvis-min-h-[1em] gkvis-min-w-[2em] gkvis-truncate")))),e}}),i(x,{get when(){return s.details.type!==y.SECTION},get children(){return i(N,{class:"gkvis-w-48 focus-visible:gkvis-outline-0",get children(){return i(E,{each:p,children:e=>i(x,{get when(){return!e.condition||e.condition()},get children(){return i(q,{onSelect:()=>e.action(),get children(){return e.label}})}})})}})}})]}})},$=R.Root,V=e=>{const[,t]=m(e,["class"]);return i(R.List,b({get class(){return A("gkvis-inline-flex gkvis-h-10 gkvis-items-center gkvis-justify-center gkvis-rounded-md gkvis-bg-muted gkvis-p-1 gkvis-text-muted-foreground",e.class)}},t))},W=e=>{const[,t]=m(e,["class"]);return i(R.Trigger,b({get class(){return A("gkvis-inline-flex gkvis-items-center gkvis-justify-center gkvis-whitespace-nowrap gkvis-rounded-sm gkvis-px-3 gkvis-py-1.5 gkvis-text-sm gkvis-font-medium gkvis-ring-offset-background gkvis-transition-all focus-visible:gkvis-outline-none focus-visible:gkvis-ring-2 focus-visible:gkvis-ring-ring focus-visible:gkvis-ring-offset-2 disabled:gkvis-pointer-events-none disabled:gkvis-opacity-50 data-[selected]:gkvis-bg-background data-[selected]:gkvis-text-foreground data-[selected]:gkvis-shadow-sm",e.class)}},t))},Q=e=>{const[,t]=m(e,["class"]);return i(R.Content,b({get class(){return A("gkvis-mt-2 gkvis-ring-offset-background focus-visible:gkvis-outline-none focus-visible:gkvis-ring-2 focus-visible:gkvis-ring-ring focus-visible:gkvis-ring-offset-2",e.class)}},t))};var U=M('<div class="gkvis-flex gkvis-w-full gkvis-flex-col gkvis-gap-2 gkvis-pl-4">'),Z=M('<div class="gkvis-px-2 gkvis-h-full gkvis-overflow-auto gkvis-smoth-scroll">'),_=M('<div class="gkvis-w-full gkvis-flex gkvis-items-center gkvis-gap-2 gkvis-cursor-grab"><img class="gkvis-h-6 gkvis-w-6 gkvis-aspect-square gkvis-object-cover"><p class="gkvis-text-center gkvis-font-normal gkvis-text-sm">');const ee=()=>(((t="pointer-sensor",s)=>{const[r,{addSensor:n,removeSensor:a,sensorStart:i,sensorMove:d,sensorEnd:l,dragStart:o,dragEnd:c,addSelectedElement:u}]=e();g((()=>{n({id:t,activators:{pointerdown:f}})})),v((()=>{a(t)}));const k=()=>r.documentState.activeSensor===t,p={x:0,y:0};let m=null,y=null;const f=(e,t,r)=>{0===e.button&&(document.addEventListener("pointermove",I),document.addEventListener("pointerup",x),document.addEventListener("pointercancel",x),y=t,s=r,p.x=e.clientX,p.y=e.clientY,m=window.setTimeout(b,250),u(t),e.stopPropagation())},h=()=>{m&&(clearTimeout(m),m=null),document.removeEventListener("pointermove",I),document.removeEventListener("pointerup",x),document.removeEventListener("pointercancel",x),document.removeEventListener("selectionchange",L)},b=()=>{r.documentState.activeSensor?k()||h():(i(t,p),o(y,s),document.addEventListener("selectionchange",L))},I=e=>{const t={x:e.clientX,y:e.clientY};if(!r.documentState.activeSensor){const e={x:t.x-p.x,y:t.y-p.y};Math.sqrt(e.x**2+e.y**2)>10&&b()}k()&&(e.preventDefault(),d(t))},x=e=>{h(),k()&&(e.preventDefault(),c(s),l())},L=()=>{window.getSelection()?.removeAllRanges()}})("layer-pointer-sensor","layer"),[]);function te(t){const[s,r]=m(t,["class"]),[n]=e(),a=()=>n.documentState.extendComponent||{},d=()=>{switch(n.documentState.mode){case D.HEADER:return[n.elementState.data.headers];case D.FOOTER:return[n.elementState.data.footers];case D.WATERMARK:return[n.elementState.data.watermark];case D.EDITING:return n.elementState.data.elements;default:return[]}},l=e=>({...e,id:O(),content:e?.content?e.content.map((e=>l(e))):[]});return i(B,b({get class(){return A("panel gkvis-select-none gkvis-relative gkvis-overflow-hidden gkvis-shadow-inner  gkvis-h-full gkvis-bg-white",s.class)}},r,{dimension:250,minDimension:200,side:"right",get children(){return[i(ee,{}),i($,{class:"gkvis-h-full gkvis-relative gkvis-z-50",defaultValue:"layers",get children(){return[i(V,{class:"gkvis-grid gkvis-w-full gkvis-h-fit gkvis-grid-cols-2 gkvis-bg-white gkvis-p-4 gkvis-select-none",get children(){return[i(W,{value:"layers",as:"h5",class:"gkvis-cursor-pointer data-[selected]:gkvis-shadow-none gkvis-border-b gkvis-border-transparent gkvis-rounded-none  data-[selected]:gkvis-border-gray-500 gkvis-text-base gkvis-font-semibold gkvis-text-gray-700",children:"Layers"}),i(W,{value:"components",as:"h6",class:"gkvis-cursor-pointer data-[selected]:gkvis-shadow-none gkvis-border-b gkvis-border-transparent gkvis-rounded-none  data-[selected]:gkvis-border-gray-500 gkvis-text-base gkvis-font-semibold gkvis-text-gray-700",children:"Components"})]}}),(e=Z(),I(e,i(Q,{value:"layers",class:"gkvis-pb-40",get children(){return i(G,{get ids(){return d()},get children(){return i(E,{get each(){return d()},children:(e,t)=>i(Y,{details:e,depth:0,parentId:null,parentIds:[],get index(){return t()}})})}})}}),null),I(e,i(Q,{value:"components",class:"gkvis-pb-40",get children(){var e=U();return I(e,i(E,{get each(){return Object.keys(a())},children:e=>{const t=a()[e];return s=_(),r=s.firstChild,n=r.nextSibling,s.addEventListener("dragstart",(e=>{((e,t)=>{e.dataTransfer?.setData("extendedComponent",JSON.stringify(l(t)))})(e,t.data)})),C(s,"draggable",!0),C(r,"draggable",!1),I(n,(()=>t.data.name)),S((()=>C(r,"src",t.icons))),s;var s,r,n}})),e}}),null),e)];var e}})]}}))}export{te as default};
